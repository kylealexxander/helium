class Product < ActiveRecord::Base
  belongs_to :organization
  belongs_to :program
  belongs_to :reimbursement_rule
  has_many :user_products, dependent: :destroy
  has_many :users, through: :user_products
  has_many :claims

  attr_accessor :manufacturer, :model_number

  before_save :set_reimbursement_rule_and_product_program_id

  def average_benefit
    0
  end

  def reimbursement_rule_percentage
    if reimbursement_rule
      reimbursement_rule.percentage
    else
      100 # or other %
    end
  end

  attr_accessor :set_program_id

  def set_reimbursement_rule_and_product_program_id
    a = organization.reimbursement_rules.where('lower(focus_area) = ? and lower(category_name) = ?', focus_area.to_s.downcase, category_name.to_s.downcase).first
    # b = organization.reimbursement_rules.where('lower(focus_area) = ?', focus_area.to_s.downcase).first
    # c = organization.reimbursement_rules.where('lower(category_name) = ?', category_name.to_s.downcase).first
    #
    # x = if a
    #   a
    # elsif b
    #   b
    # elsif c
    #   c
    # else
    #   nil
    # end
    x = a

    # self.reimbursement_rule = x
    # self.program_id = self.reimbursement_rule.try(:program_id)
  end

  def focus_area_image
    if respond_to?(:category_name) && category_name =~ /bike/i
      return "data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wCEAAkGBwgHBgkIBwgKCgkLDRYPDQwMDRsUFRAWIB0iIiAdHx8kKDQsJCYxJx8fLT0tMTU3Ojo6Iys/RD84QzQ5OjcBCgoKDQwNGg8PGjclHyU3Nzc3Nzc3Nzc3Nzc3Nzc3Nzc3Nzc3Nzc3Nzc3Nzc3Nzc3Nzc3Nzc3Nzc3Nzc3Nzc3N//AABEIALIBEAMBIgACEQEDEQH/xAAcAAEAAQUBAQAAAAAAAAAAAAAABwIDBQYIBAH/xABLEAABAgQDBQQFCAYHCAMAAAABAgMABAURBiExBxJBUWETInGBMpGhscEUFSNCUmJy0TOCkuHw8RYkQ1NjorImNHOEhZXC0idEg//EABUBAQEAAAAAAAAAAAAAAAAAAAAB/8QAFREBAQAAAAAAAAAAAAAAAAAAAAH/2gAMAwEAAhEDEQA/AJxhCEAhCEAhCEAhCEB5qhUJOmsdvUJpmWZ3gnfeWEi/K54xYZrlIfALNUklg/ZmEn4xjsbYYaxTSRKLdLTrat9peoCrWz9cQdiTBFcw8lbkzJqclhc/KZe6kj8XLzgOihPyZFxNsEc+0EfBUJI5Cblyf+Kn845PS244sJSla1HRIFyfKMvI4Sr08Ly9Cnlp4KUwUJPgVWBgOn0OtrF0LSofdN4rjmKn4Vrk05MCn0p11Uvk4phxKkpN7FIUk2KhxANxHslk42pb4TKsYjYcTolDbyknysQYDpGEa5gKpVaqYeber0o9LTyFltfaslouAaL3SBa9/C4No2OAQhCAQhCAQhCAQhCAQhCAQhCAQhCAQhCAQhCAQhCAQhCAQhCAQhCARQ802+0tp5CVtrSUrSoXCgciDFcICKcV4JmsPyMtM4TbeJYcIPyVhImkpIIF3ElKlpF7WNzbnaPDgCq/PUy1h3FS6st1SStpl5/6JxO6FWXotV7kgKKhaJkiKNqjaqHiuiYlYSQAQh23EoN/alSh5QEpsMNS7KGZdpDTSBZCEJCUpHIAaRcilpxLraXGyFIWApJHEGKoBCEIBCEIBCEIBCEIDwzlYpki+mXnajKS7yhdLbryUqPkTGlV7aZLyDrzUkJN3cc3Apcxe4vYqsOGp6xFW0GTqlOrj7NRS92bjynG3Xcy6B3d65ve4Cb+WmkbhQ9kHy6RlZ5yupSh9tLqOwl8wCLjPeHugPJXNpdeqk+y5h54ysvLoHao7JJSty+ZUVaJtbiLZ58Ykej7QKHPMS6pyYFPdeQlSUzPdQq+hSvQg8M+MYbDWzOYoNSamWq6Sw2+HS0iVCS4APRKrki+V7cusb7NyMnOyxlpyVZfYOXZuthSfUYi2rjDzUw0l1h1Dras0rQoKB8CIuRgaVhSRo1Q+U0l6blWDffkkPEsLJGu6b2I6ERnoqEIQgEIQgEIQgEIQgEIQgEIQgEIQgEIQgER5toU45hsMIp7j4S4l7t0mwasbHhqQSLdeNokOMHVEyk185OVJaUyMpLqaUVaIKkXcV+wpIB6qHGA17ZfiVU7hZtE/wBopcov5OHGmVqG4kDd3rA2No3iWmWJpvtJZ5t1F7bzagoX8o5pwlPYkbnFSOFZiYS9MZlptSBv7oOffyGUbS5SNqL0wmYW1OB9OjqZiXQrwJSQSOhygJyhENMyO1Qpe7RU5fc7l5tgd7eHI8r6xR82bV1auzg/5xj84CaIRDHzPtUOszNj/nmvzh8w7UjrOzY/6gn84CZ4RDAw5tPOtQmv+5fvj7/RjaYdanND/qavzgJmhEOPYT2jLUkt1aYA3Egj5zWM7C/HneLZwbtIVrWX/wDursBm9utNdmqBJzjbKFIlXvpHN6ykpVYWAtoTbjyi9sSqrk7h5+SmJhbjkk4EoSq3cbIyAyvqFa34RqlRwDjyYlXEz1TMxL23ltvVNxSTbPMKy4RZ2MVdmnYjdk3x/vzYQ25vZJWDe1uN7+wczATvCEIBCEIBCEIBCEIBCEIBCEIBCEIBCPilJQkqWoJSMySbARgp/GmGqeSmZrUmFDVLbnaEeSbmAz0I0te1LCKDYVB1XVMq5/6xel9peEXyEirBsn+9YcSPWU2gNuhHhptZplUTvU2oSs0P8F5KiPIR6JqZYk5Z2ZmnUtMtJK1rUbBIGpgLqlBKSpRsALkmIwxdNTNcekMIU9a23qiv5XPuAZstE7wSeoTbLokcYydYxdIVOVfnpKcvR6aA7MONndVNOnJDABFwknNR45AZb1qtl9JmDLzWJqsN6o1ZRWCR6DXADkDr4BMBpOJ5FnA+0enTsi0GZFXZuJQnRKQNxweoX/WicEkKAINwdDEd7bKZ8pw7L1FCe/JPAKPJC8j/AJt2Nj2fVT52wjT31Ku4hvsXM/rIy9oAPnAbFCEIBCEIBCEIBCERntTxyJBtyh0h0/K1i0y8g/okn6oP2j7B10DE7UsaLqLysO0NSnGyvs5hbWZeXe3ZptqL68zlpros/TKlg+vSonghuabS3Mp3FXAB4X5ggg+ESpsuwL81Nt1qrtWn1p/q7Kh/u6TxP3iPUMucWdt1AbmqUzWm0EzEsQ04bm3Zm9svxH2wEi02dZqUgxOyq0rZfQFpKTfWPTGi7I8Qt1bDaJBdkzdPAbWnTeQb7qh7vERtFTr1IpWVRqUpLK+y46Ar1awGShGmzG0/CbJITUHHSP7uXcPtIEWE7V8LE5vzSRzMuqA3mEa5IY7wvUFBLFYl0qOiXrtH/MBGwtuIdQFtrStCswpJuDAVQhCAQhCAQhHjq1SlKRT3p6fdDUuym6lH3DmTAX5mYZlJdyYmXUNMtjeW4tVkpHUxFmLNsDMupcthxlLyhl8qfB3f1U6nxNvCNExzjifxXNlAKmaehX0UsD/mVzPuivDOA56pyzVTn0Oy9MU4hBdS2VOKClAbyUcRmLq0AzztAYes4lrVdXepTz74JyQpVkeSBYeyPTTMF4lqo3pSkzRTf0lp7JPrVaJ+w7hGiYdsJGTQXuEy6Apzw3uHlaM9ou/2oDnxrZPipZIUxLoUADZcwPhflFqa2YYslTlT23/+E+g+8iOiP7T9WGrngP490ByvP0up0d0fL5GckXEnuLcbUkX6K4+RjKVmv19uiN0x+tmeln0IcU0pQdKRn3VK15ZX9UdIzDLUwjsZhtDrasyhYuD4iIn2rYQw1SaX86SrZkpxTgS0wx6Dp4936thc5W8M4DWcMS1MxLV6JRJFhUrKISXp7tXBvTLguTbPPKwFrGxNxkLdBNoS2hKEJCUpFgBoBHKlTpFUocw0anKPSjriQ6yo5XGoII4jLqDEqbONphmXGqRiR0dqohDE6rLePBLnXkrjxzzISTiCmorFEnqcu1pllSATwURkfI2MRvsOqK0GpUZ/urSQ8lB4Ed1Y/wBMSxEMTP8AsptiC/Qlpx0L6bruR9S971QEzwhCAQhCAQhGsY7xbL4Wpu8N1yfeBEuyef2lfdHt0gMdtIxsjDsoZKQWlVUeTlx7BJ+uevIefjrmy7BKppxGI64hSrq7SVadzKzr2qr69PXyjHbP8JTOLKmuv18rdk+0K/pNZpf/AKj93OJrACQABYDQCA+xpe0DGNBo8hM02f8A65MvtFJlGiLgEaqOiefPkIwW0naOae47R8PuAzYul+aGfZHilP3uZ4eOkWUSi1LEdR+TU5pUxMrO8464rupv9ZSj79T1gPHK1Cbld9cjMvSzjiOzWplwoKgSDa4OlwIu02i1asOEU6RmppRUQVttkje6q0HmY2jGuz53ClNk5z5WZrtlFEwoJslC9Rbja18zy62iSdk1cTVcLtyrhHyinkMqHNH1T6rjygIzl9lWKnkBTkqyxcjJ2YTfP8N4HZhXvlr8mlckt9hlDziUvnJKioDVP3FR0IrTzEFgbqjbMi0BzdUNn+KKegrcpUwtA4skO+xJJjHUutVrD76vm+cmJVST30A92/VBy9YjqNZsknkIxVaw7SK1L9nU5Jp6ybJctZafBQzgI9wptdQ6pEtiNkNnT5UwDb9ZPxHqiU5WZYm5duYlXUPMuC6HG1ApUOhiEMY7L52ktLnaUpU5Ki6lIt9K0PL0h1HqjB4LxlUMKTgSCp6RWfpZZRyPVPJX8GA6QhHio1Vk6zTmZ+nuhxh0XB4g8QRwIj2wHwkAXJsI582pYwXiOrGSknD83SqilsJOTqtCs/Dp4xJe1zESqJhoy8uvdmp8lpJBzSi3fPuH60RJs7w2rElfbbdbUqUZs7M7v2AfR8zl4XgNp2W7P257s6zXGryx70swoZPfeV93kOPhrM9g3YpACdCBHxtDQaDbYCUJAASkW3QNBbhH0Gx3V8dDzgKljeTrYjMGKN7eRvWzTmRyipOXdPl4RSvuK3+ByV+cBV/aD8MfU8T1i0k7qrfYBHll8IupFkgHWApv3lKJsEjjEWyf/wAg7QFTa+/Q6R+iB9FxV8v2iL/hSBGX2p4hckKS3SKeSqoVQ7gCPSS2Tb1nJI8+UZ3BeHm8P0BiRsntD9JMKH9o4dfIZAdBAe2t0aRxFT1yVSZ7SWVmOCgeBB1Fvb4a8743wnOYSqhln7vSrtzLv2ycTyPUcR+cdMlwklLY3jxPARhcV4alcS0Z+RmrdsoXZeI/RLGhHTnzEBqOyHGpq0sKJU3SqdYRdh1ZzebHAnipPtGfAx59udMPyemVhod5lwsOEcld5J8iD+1ERsOT+G6+lQBYnpF/Q/VWk2I6g5jqDHQdb7HGuzt96STf5VK9synil1OYT4hSd0+cBmcL1MVjD8hP3up5lJX+IZK9oMZSI02HVYTVDmqcpXelnAtAP2VfvHtiS4BCPCxWabMVBynsTzDk42CVspWCoWNjl0JF+V4VqrSdEpr0/UHOzYaFzzUeAA4kwHkxXiKTw1Slzs2d5Z7rLIPedXyHxPCIiwzRKjtExE9VKu4r5ChY7ZwZA20aRyFvUOpi2y3Vtp+KipZLMm16RGaZZrkOaj7T0GU3UmmylIp7MjINBqXZTZKR7zzJ5wF+WYalZduXl20tMtpCUISLBIGgEaLtWxmcPyAp1Pc3alNIJ306st6b3icwPM8I3apzzFMp8xPTSt1mXbU4s9APfHMFYqE7iWvvTTiVOTM28AhtOepslA8MhAenCWHJzE9UTKy4UlpNlTD9rhpF9ep6cfAGOi6FQafQqa3I01kNtp7xV9ZavtE8T/LSPDgXDzGGqE1JJSPlSu/MrtmtfHyGg/OM8fo8x6HHpAY7ENKartFm6ZMWHaoslVvRUM0q8iBEK7P597DONfkU5dpLylSjyTwVew9ShE+qG8LjUaGIf2yUFUvOsV2VTu9qQh+31XAO6rzA/wAvWAl9XojxHvj6vTzEYPB1ZTXcMyM9cdoUhDovotOR/PzjOK1T4wBfAczAd434DSKT3nLDQDOKiTfdT/KAE3O6nXieURTtRwC0WHq3RmggpBXNMIGVuK0/EefO8rd1A/jOPm7vZrH6sBz5s2xa5hqsBmacPzdMkJeSdEHgseHHpHQqVBSQpJBBFwRxjnnahhpOHsQFUqkJk5oF1lI+p9pPkdOhESXsfxAavhv5E+vemaeQ3mcy2fRPsI8oCOdstUVUMYOSqVXakm0spHDeI3le8DyiRNjlJFOwombW2oPT6y4VEaoGSR4an9aIRxHNGdxHUpm9y7NOqHmo2+EdOURlqSpEjKI7oZYQ2AobpySBoYD2kIWdRccQcxFKgoAhQ30+2LhAOoB8Yp3eRIgLYVoL3tofgYughSb8DFC297Wx9hi2grZVZwXQdFdesBSruPJbN+8LDqLj4X9UVVGbZkJCYnJle4yw2pxauQAvHnqU3LSykPTD7bQbBUFLNsyUpHr3recR/jivpxLPSGHaU4XJV5Tbk6tN7bpUNxBt1IJ5DwNgpwBLOYmxFO4vqrP0SV9nItrz3baWH3RbPmSeBiTrKc9Pup+yDn5n8o8dPlafRae1KsrabaYRu3WoDxJ87n1x9cq0iDZU9KtDmt5IPqv14wHsKkNgDIckgfCPllr1uhPIHP1xixiKgoNhVpJazb0X0qJ05HqIq/pFTVAFp5xy4uOyl3HP9KYCItudBRI1aUqss2ENziCh3dFh2iOPiUkfsmM5sFrBfkKhSHFElhaZhoH7K8lAeBF/1o9m11TFYwisol51K5Z9txLz0u42hGZSSd4Dgo8OIjQNks6KVi9kNPIfW+y6z2SVboUN3fvvGwFt33wGx4X/ANlNrc3Sz3JaZcU2gcN1ffRb2DyjL7XadiWbK5ySU2mjSctvufT7hJB3lG1xwA+EajtNrsq/ilioy43JuTAaWqXX2iQtKlFIUqwAVrlncZxVjbaPVa3QvmmYpJkG55Lboe3j9Ize908CCU635jhAYKnyldq1LenZFsGTkM1zHbBoN5cVFQKsj1OcXqaa7jWfl6U3MOPJCy4Sons2tAVnwAHw1iwxM1GrUym4WozKyytwuOBB/TvE6qtolKQBn9m54WnfA+E5XClKEu1uuTTllTL9vTVyH3RwgPfhqgyWHKU3ISCO6nNxwjvOq4qP8ZRlYQgI025VhUpQJWmtqsqdd3ljmhFj/qKfVGnbFaMJ7Ei6g80pbMgjeBtkHFXCfYFHxAivbnNl7FjEtfuMSiBbkVKUT7LRuexCWRLYSdmClW/MzKlX3DokBIF7cwfXASGdxeVxf2iPlyj0u8OcCpBFiDbqkxTdA9FZT5/nAfQQgXSbt9Pq/ujw4hpLVco01T3SAHkWSq191WqVeRsY9ZVbNC2zzF7XihMy2g2WdwcifR8+XugIq2V1B+iV6cw3UB2fbK32gTl2iTYgeIB/ZiXFnvJA1ztESbWJNVJrVPxFTFALLt1FJBs4mxHkQD6jziSqZVWKlTpeoy6gQ+yHEjiAeEBkEcd3UnWKid3upF1axabV3AlsKNsioj84rBIyQnPjc++AqACe8o3POFyrTujnxj4EKvdSgT0GkVbl9VKPnaA03avR0VHCEy6lA7aTUJhJ42GSv8pPqERhsgqZp2M2GFKs3OIUwrx1T7RbzieZ6SZnJJ+WcbSpLzakG4vkRaOYaE8qRxHT3jkpmbaUfJYvAeBZtUe//e96/jHWaXmVoBS4hSSOCgRHKmKpVUliOqSxG6Wpt1I8N429lo6eoc+3P0WQnEqBExLtuC3VIMB6/ohopKfwqtDeto8g/itFe8o+inLmcopXkPpFnwTlf4wFJfCfS3c9N1QMWX51kIWLXsLkKyi+lBPDcB1tqfEx9WoNI7uRJsB1gOcccVeqT9R+UTkytTS0BxttLl0MpJUAkWyvYa8Y8+FVtB0vOLkQ40vtCZ15tKXQRu7hSsG4zJyN9OQMSjiHZlKVeoOT0pMKYC1HeZdzTforVOdzxF4qkMK0WnMFqewj2lgCXmiZrP17414J90BiE1xhm6xTMHPOFN7CYYQB0vvkjyBjyPbQDIE3w3Q3LC5MrPoA9QTc+2Ntl8N4Fnl9nLSkiVkd5hwqQ4n9W4VF97ZlhNfpUlxvq1Nukeoq+EBpje2N5AsMOtgDgmoqH/hHsZ2yy5H09EfR+Ce3vekRm3Nk2FnTZtc+0eSZjP1KBjzr2M0E+jUaqn/9Gj/4QGAxZtQpdaw3P05EhUW3n2t1BUWygG4Iv3r2y4CIjl5l6XeS9LOOMvJJKXEKKVJuLGxHQkRK2PdnFLwxht+qS9RnXXULQhDbu5ZRUoDgBwufKNGwdQ0YkxBLU12ZEql4q3nrAkWSSAAdbkWgNgl6nRXNlRw886y3U21fLZfcBV2iu0PdNhkvcunPKxGettUSqbnlSktdcwplHYS7YzNioq3U+JUfXGw40wrRsNuJYla4ufn75splwEoHNSt7XoL9bRc2b0OtVKtKmKBNSsrMySQouzA3gN66chY3OsBsKsH1HZ9Q5HE7E0TPS7qfnBgK7nZrISAOZBIB53NtBeZafNtz8jLzbP6N9tLifAi8RFtNk8YM4ca+eZ9mbkg7aZMuEpBN/oyRug24anO0SJs+QtGDKSly+92F8+RJI9kBsMIQgOd9sl/6eTd/7tq37AiVtkikDAFMAUm93r5/4q4jjbnLFnFzD9u6/KIN+oUoH2Wjedis4h/A6GSoXlZlxtV+FyF/+cBvwUnmPXH245xRvoPogq8Bl64+d46NpHiYC5HxzdCSV6RYOYyseqUgCPqJZF95xIUeRzAgNE2qUyamaQ3NydlCVKlLbSgKURawueQudOcanshrk+ipCiKUtUm9vL3Qm+4QLnqOETK+hCnEtBtJuk3FuGQzjxSdHp9OnC9KyjLLzpO+62iyldCeUB7wUmyS5uC3o3Ai4kItYK9RilSFJzBuniCMx1FobxAutO8n7QzgLm6OvrMNwdf2jFI7LkkeItFW4nr6zAChJFje34jHKiu9Wj2fGZ7v7WUdO12ZTT6NPTpWpAYYW5e/JJPGOacJyqp7E9Kl7bxcm2r+G8CfYDAbJtppBkcYqmkps1PtJdB++BuqHsSf1o33YlWG53CZkVEB+QcKFcyhRJSfePKPftaw4qvYXW7LIKpyQJfaAGa0276fMZ+KRELYCxJ/RnErE46CqUc7kwkZ90/WA5g5+vnAdN7yl+gMvtH4R9SgJzzJ5nWKWnm3mkOsrS4hxIUhSTcKB0IirdKvT0+zAfN8qybF/vcIskby1LBJSgZq4k8QIuOG6Tb0en1ukCndQhvmRf3wHxxFpUt6HdsCOf8AOKQqzpctYbiQocsz7ouuZlCeavdn8ItpAEy4g5hSAbHxN/46wFqekpWbSUzku0+yfSS6gKA65/x6oxysPtSlzTpmblEHg0+bI8Equm2Z4RmW9C2rMp58Rwgjunszp9XwgMSW6013UTcpNDg3NslpR1+skkHhomKhUJ5g/wBbo8ykcVyrqXk8eBsrhwTxjJEBvurALRyF+HTwixUZlqlyExOvvhphhsuLLmaQB7f40gIm221w1KWp1LkW3iEuKmHkraW2pJA3UgpIBI7ys9Mo03CWC6hiKlVOZlEHtZXcDbarDtVG5Kc+IFtSNYxOJazM4jr0zVXkqSuYX9G2DctoGSUj1DxN+cblV504NkKXQmRJIrBaS9NzUwlSltKWSoJBSbjdAH8GAxLyRWf6N4ekmXG54AtzKnm91aVqUd0Z57qEXVbTvHjG+z9WomA8eNpaLoYXIMsTCGUhQQBvAKUNSruo8idbiItYem6zUS45JvzjzrhP0aFKcVl3QVC+ndFzyiZabsloLQbdnlTL7pALiC73d62fC5F4Dw1mrL2jz0vRaCl4UZC0uzs4tspC7aJAPC+fMnoM5NYZRLsNstJ3W20hCRyAFhFmm06TpcqmWp8s3Lsp0SgW/nHqgEIQgIv28Uov0WRqjaLmUeLbh5IWNf2kpH60a9sJqyJetzlLe3f620HGSR9dF7geKTf9WJir1LZrVHnKbMZNzLRQT9k8D5Gx8o5gInsN16y0hudkH80nQlJ06pPtBgOqiu5sgbx9g84+FP8AeHe5J4Rj8O1uUrtGlajIkbjyP0d80KGqT4GMmlNs1Zn3QHxKc7q190fFqz3U6+6ClEkpR5q5fvj5klJtw06mApZTZ1SuJGZ/jzj7MDRX2bm3McYqQN1ZHJI+MFi6rHQpPwgCTawvcHQwsUG6fR4jlFKMwArRQv58YrSSDuq14HnAAOKNOXCACTwseWkCCk3TmOIi3NzMvKSrs1MupaYaQVrcUckgcYCP9tda+b8OIprTv00+5uqT/hpzJ9e6PMxp2xOkGdxQuoLTdqQZJBt9dd0j2b8axjHED+KMQOzq94tA9nLoIzSgHLLmdT1MTts4w4cN4aZYeTuzj57aZ6KIyT5Cw8bwG0xz7tZwWqg1NVSkWj82Ta7jdGTDhzKfA5kerhn0FHmqEjLVKSekp5lL0u8ndcbVoRAQtsmx8ilEUWsrCZRR+hfV/ZHkr7vu8NJtQ4l9AW2oFs5hQ0UOnSOdtoGAp3C0yZmXDkxSlK+jmAO81ySvl46Hoco9uB9pc7QENyVRBmZEZJuc0DoeHhp4QE+ek5YaI9/8vfH3V78Kff8AyjE4exHS63LoVIzaFvKG8pomyweOXEdRcRlWTvArGYUokW5afCA+nN4fdT7/AOUW15LW59i1/Dj74uN5uOHqB/HrMfEZrdv9r4CAOgizidU8OY4iPqwHEApOeqTHxm+6UnVB3fy9lowWIMX0TC6Vpqs6lC7bzbDffcV0CRp52GcBnS4gMqW8UoSkErKjkkcb9IgPahjv5+dVR6U6VUlhy6nRkZhQ0/VB0568BfHY52iVHFTi5eXSqRphyLCVd50DQrPHwGXjlFzZ3s+m8UzCJucS5L0dB7zuin/uo+KuHjoGX2O4OVVakmvVBofIpRf0CSMnXRofBPvtyMTZP0yRqDDrE7KMvNvJ3XAtAO8PGLslKS8jKNSkmyhmXZSENtoFgkDhF6AxWHcPUzDckqUpEv2LSl76rqKlKPMkm5jKwhAIQhAIQhAIizbJgxc+z/SCltb0ywi002kZuNjRQ6p48x4RKcIDm3Z1jNeEqmrtklymzBAfQkZoPBaeo5cR5R0JT6jK1aVRM02YQ9LOC4eQbg9B158vGIl2l7M3GXHqxhtgraUSt+SbGaDxUgcR93hw5DRMJYwq2E5pTlPd35dZu7Ku3La/yPUe2A6fNkgIRkT7OsCBdCBpr6v4EaVhTaXh+u2RMTCafPKNuwmVboPIJXofYekbo0pLhUtJCk3sCNDb9/ugPqf0ivACPv8AaeUfEem54gewR9H6Uj7o+MBSBcKSNQrI+34xVktPI+4x8uA6RzTf8/hGr4jx5QsPFYem0vvWN2ZdQUQrqdB78tIDZnJhthpxyYcQ2htO8tajYAc78ogzabjv58eVS6S4pNOQq7itO1UOPQdPPXTE4yx5U8Tq3Cfkkin0WkHXxPHTX2CM3s82bP1dbdRrjS5emjvNsK7q5j4pT11PDLOA9OyHBSpyZbr9SatKsm8ohQ/SrH1/AcOZ8M5rihptDLSGmkJQ2hISlCRYJA0AEVwCEIQFDrbbzSmnkJW2sbqkKFwociIivF+x9iZU5N4YeTLOHMybp+iP4Vap8DceESvCA5TqVNrWGJkIqErM09e93SofRrP3VeifIxmqVtLxLTEIbROds0kWCXbK/wBVz6jHR7zTb7Smnm0ONqFlIWkEHxBjVKls0whUFFS6O2wsm+9KrUz7EkD2QEaS+2mssoKXafJOZk33Vg5m/wBqLb22mvntPk0hT2ys3utC1WyAy7w5RuD+xPDziypqfqjSfshxs29aCY+y+xTDrawp2eqjoGqVONgH1IEBFlV2iYrqu/2tVcl0LTuqTKANZZ8R3uJ4xiqLQaviKZUKXJTE4tSu+4kXSD95ZyB8THRFM2cYRppCmaMy8sG4VNKU9nzsskRtLTaGW0ttIShCRZKUiwA8ICKsHbHmJRTc3id1E06MxJsk9kPxK1V4ZDxiVmm0NNpbaQlCEABKUiwSBwAiqEAhCEAhCEAhCEAhCEAhCEAjSMZbNKPiRa5pm8hUFZl9lPdcP30cfEWPWN3hAcz4i2cYloilqXIKnJcaPyYLgt1SBvD1W6xg6ViOt0VSmqXV5uV3DYsoc7qT+A3F/KOtI8NSo1Lqqd2p06Umx/jsJX7xAc+Sm1fF0sCFzsu+Sbkuy6L6W+rblFTu1nFzpUUTUs0pQAu3Lpy1535xMT2zTBzqipVEaST/AHbriB6gqPjezPBzelFQfxPOK96oCAari3EFVsKlV5lwHu7m/upN+G6LD2Rk8PYBxJXFJWxTnGGT/wDYnbtpHgDmfIGOiKbQaPSrfNlLkpS3FlhKD6wIyMBoWENl9JoS0TVQV85Tyc0qcTZps/dRz6m/S0b7CEAhCEAhCEAhCEAhCEAhCEAhCEAhCEAhCEBQD9KodB8YrhCAQhCAQhCAQhCAQhCAQhCAQhCAQhCAQhCAQhCA/9k="
    end

    if focus_area =~ /home/i
      return "http://www.appliancesconnection.com/blog/wp-content/uploads/2015/04/ES.png.png"
    end
    if focus_area =~ /trans/i
      return "http://japandailypress.com/wp-content/uploads/2012/07/fuel-cars-415x260.jpg"
    end
    if focus_area =~ /food/i
      return "http://www.motherearthnews.com/~/media/Images/MEN/Editorial/Articles/Magazine%20Articles/2014/02-01/Choose%20the%20Best%20Compost%20Bin/Compost-Bin%20jpg.jpg?h=367&la=en&w=550&hash=1836A55781D27C116F4A2D0DF99534A1E4F20FA8"
    end
  end

  def focus_area_description
    @focus_area_description ||= if desc = ReimbursementRule.where.not(focus_area:'', focus_area_description:'').where('focus_area = ? and (category_name = ? or category_name = ?)', focus_area, nil, '').first_or_initialize.try(:focus_area_description)
      desc
    else
      "Description for #{focus_area} goes here"
    end
  end

  def image_url
    if focus_area_image
      focus_area_image
    else
      'http://placehold.it/300x180'
    end
  end

  def self.unique_focus_area_names(organization_id, program_id=nil)
    if program_id
      ReimbursementRule.where(organization_id: organization_id, program_id:program_id).all.map(&:focus_area).map(&:strip).uniq.compact
    else
      ReimbursementRule.where(organization_id: organization_id).all.map(&:focus_area).map(&:strip).uniq.compact
    end
  end

  def self.unique_category_names
    ReimbursementRule.all.map(&:category_name).map(&:strip).uniq.compact
  end
end
